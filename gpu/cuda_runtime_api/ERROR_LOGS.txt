EXPRESSION INSIDE KERNEL - DOUBLE_PRECISION

1>stencilexprtemplates.cu
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(107): warning: variable "NW" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(109): warning: variable "NE" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(110): warning: variable "W" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(111): warning: variable "CENTER" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(112): warning: variable "E" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(113): warning: variable "SW" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(114): warning: variable "S" was declared but never referenced
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(115): warning: variable "SE" was declared but never referenced
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<1, -1> > >::operator TwoOpExpression<Mul, double, VarExpression<1, -1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<-1, -1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > > >::operator TwoOpExpression<Mul, double, VarExpression<0, -1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<1, -1> >::operator VarExpression<1, -1> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<0, -1> > >::operator TwoOpExpression<Mul, double, VarExpression<0, -1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<-1, -1> > > >::operator TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<-1, -1> > > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<0, -1> >::operator VarExpression<0, -1> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<-1, -1> > >::operator TwoOpExpression<Mul, double, VarExpression<-1, -1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > > >::operator TwoOpExpression<Sub, TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<-1, -1> >::operator VarExpression<-1, -1> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<0, 1> > >::operator TwoOpExpression<Mul, double, VarExpression<0, 1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> > >::operator TwoOpExpression<Add, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > >, VarExpression<0, 0> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<0, 1> >::operator VarExpression<0, 1> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<0, 0> >::operator VarExpression<0, 0> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > > >::operator TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > >, TwoOpExpression<Mul, double, VarExpression<0, -1> > > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > > >::operator TwoOpExpression<Sub, TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > >, TwoOpExpression<Mul, double, VarExpression<1, 1> > > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<1, 1> > >::operator TwoOpExpression<Mul, double, VarExpression<1, 1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > > >::operator TwoOpExpression<Sub, TwoOpExpression<Mul, double, VarExpression<-1, 1> >, TwoOpExpression<Mul, double, VarExpression<0, 1> > > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<1, 1> >::operator VarExpression<1, 1> const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<TwoOpExpression<Mul, double, VarExpression<-1, 1> > >::operator TwoOpExpression<Mul, double, VarExpression<-1, 1> > const&() const
1>./d:\projects\advancedcpp\trunk\proto\gpu\cuda_runtime_api\exprtemplates.h(32): Error: Recursive function call is not supported yet: Expr<VarExpression<-1, 1> >::operator VarExpression<-1, 1> const&() const
1>CMake Error at CMakeFiles/cudaproto_generated_stencilexprtemplates.cu.obj.cmake:256 (message):
1>  Error generating file
1>  C:/cmakebuilds/proto_gpu_cudart/Debug/cudaproto_generated_stencilexprtemplates.cu.obj
1>Project : error PRJ0019: A tool returned an error code from "Building NVCC (Device) object Debug/cudaproto_generated_stencilexprtemplates.cu.obj"
1>Build log was saved at "file://c:\cmakebuilds\proto_gpu_cudart\cudaproto.dir\Debug\BuildLog.htm"
1>cudaproto - 1 error(s), 16 warning(s)
2>------ Skipped Build: Project: ALL_BUILD, Configuration: Debug Win32 ------
2>Project not selected to build for this solution configuration 
========== Build: 0 succeeded, 1 failed, 1 up-to-date, 1 skipped ==========


EXPRESSION OUTSIDE KERNEL - DOUBLE_PRECISION

1>------ Build started: Project: cudaproto, Configuration: Debug Win32 ------
1>Building NVCC (Device) object Debug/cudaproto_generated_stencilexprtemplates.cu.obj
1>stencilexprtemplates.cu
1>stencilexprtemplates.cu
1>stencilexprtemplates.cu
1>tmpxft_00000f20_00000000-3_stencilexprtemplates.cudafe1.gpu
1>tmpxft_00000f20_00000000-8_stencilexprtemplates.cudafe2.gpu
1>stencilexprtemplates.cu
1>D:/projects/advancedcpp/trunk/proto/gpu/cuda_runtime_api/stencilexprtemplates.cu(69): Error: Formal parameter space overflowed (256 bytes max) in function _Z9Stencil2DI15TwoOpExpressionI3SubS0_IS1_S0_IS1_S0_IS1_S0_I3AddS0_IS1_S0_IS1_S0_IS1_S0_I3Muld13VarExpressionILin1ELi1EEES0_IS3_dS4_ILi0ELi1EEEES0_IS3_dS4_ILi1ELi1EEEES0_IS3_dS4_ILi0ELin1EEEES4_ILi0ELi0EEES8_ES0_IS3_dS4_ILin1ELin1EEEESE_ES0_IS3_dS4_ILi1ELin1EEEEEvPKdPdjjT_
1>CMake Error at CMakeFiles/cudaproto_generated_stencilexprtemplates.cu.obj.cmake:256 (message):
1>  Error generating file
1>  C:/cmakebuilds/proto_gpu_cudart/Debug/cudaproto_generated_stencilexprtemplates.cu.obj
1>Project : error PRJ0019: A tool returned an error code from "Building NVCC (Device) object Debug/cudaproto_generated_stencilexprtemplates.cu.obj"
1>Build log was saved at "file://c:\cmakebuilds\proto_gpu_cudart\cudaproto.dir\Debug\BuildLog.htm"
1>cudaproto - 1 error(s), 0 warning(s)
2>------ Skipped Build: Project: ALL_BUILD, Configuration: Debug Win32 ------
2>Project not selected to build for this solution configuration 
========== Build: 0 succeeded, 1 failed, 1 up-to-date, 1 skipped ==========


IMPOSSIBLE TO DEBUG

auto is supported by VC++ 2010 and gcc 4.5.x; none of which works with CUDA 

cannot use external libraries since everything *must* be prefixed with __device__

1>------ Build started: Project: cudaproto, Configuration: Debug Win32 ------
1>Building NVCC (Device) object Debug/cudaproto_generated_stencilexprtemplates.cu.obj
1>stencilexprtemplates.cu
1>stencilexprtemplates.cu
1>stencilexprtemplates.cu
1>tmpxft_00001484_00000000-3_stencilexprtemplates.cudafe1.gpu
1>tmpxft_00001484_00000000-8_stencilexprtemplates.cudafe2.gpu
1>stencilexprtemplates.cu
1>ptxas C:/Users/uvaretto/AppData/Local/Temp/tmpxft_00001484_00000000-4_stencilexprtemplates.ptx, line 127; warning : Double is not supported. Demoting to float
1>tmpxft_00001484_00000000-3_stencilexprtemplates.cudafe1.cpp
1>tmpxft_00001484_00000000-14_stencilexprtemplates.ii
1>Linking...
1>Embedding manifest...
1>Build log was saved at "file://c:\cmakebuilds\proto_gpu_cudart\cudaproto.dir\Debug\BuildLog.htm"
1>cudaproto - 0 error(s), 0 warning(s)
2>------ Skipped Build: Project: ALL_BUILD, Configuration: Debug Win32 ------
2>Project not selected to build for this solution configuration

IN ORDER TO BE ABLE TO EXECUTE METHODS ON BOTH HOST AND DEVICE (i.e. without CUDA) EVERY METHOD MUST BE DECLARED TWICE WITH AND WITHOUT __device__

IMPORTANT: the maximum number of concurrent kernel instances is a function of the kernel size; using C++ the kernel size can easily explode!

Impossible to use the STL: http://stackoverflow.com/questions/2352090/cuda-with-mapvalue-key-atomic-operations (__device__)